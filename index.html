<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taalvaardigheid Rapportage - Politieschool</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f2f5; padding: 20px; color: #333; }
        .container { max-width: 1000px; margin: auto; background: #fff; padding: 30px; border: 2px solid #003366; border-radius: 12px; }
        h1, h2 { background: #003366; color: #fff; padding: 12px; font-size: 1.1rem; text-transform: uppercase; border-radius: 4px; margin-top: 30px; }
        .instruction-box { background: #fff4e5; border-left: 6px solid #ffa500; padding: 20px; margin-bottom: 25px; border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #999; padding: 8px; }
        th { background: #eee; }
        input[type="text"], textarea { padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 100%; box-sizing: border-box; }
        .correct { border: 2px solid #28a745 !important; background: #e8f5e9; }
        .incorrect { border: 2px solid #dc3545 !important; background: #ffebee; }
        .res-card { border: 1px solid #ddd; margin-top: 15px; border-radius: 8px; background: #fafafa; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .card-header { background: #e7efff; padding: 10px; font-weight: bold; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; }
        .student-sentences { padding: 15px; font-size: 0.9rem; line-height: 1.6; background: white; }
        .feedback-area { background: #f0fff4; padding: 15px; border-top: 2px solid #28a745; }
        .checklist-box { margin-bottom: 10px; border: 1px solid #c6f6d5; padding: 10px; background: #fff; border-radius: 4px; }
        .feedback-box { background: #ebf8ff; padding: 15px; margin: 10px; border-left: 5px solid #3182ce; font-style: italic; }
        button { background: #003366; color: white; border: none; padding: 10px 15px; cursor: pointer; font-weight: bold; border-radius: 4px; }
        button:hover { background: #004a94; }
        .btn-reset { background: #c00; float: right; margin-top: 20px; }
        .nav-btn { background: #555; margin-right: 5px; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h1>Taalvaardigheid: Bijvoeglijke naamwoorden</h1>
    
    <div style="margin-bottom:20px; background: #e7efff; padding: 15px; border-radius: 8px;">
        Voornaam: <input type="text" id="firstName" placeholder="Typ je naam..." style="width: 200px; display: inline-block;">
        Klas: <select id="selectedClass" style="padding: 8px; border-radius: 4px;">
            <option>Delta</option><option>Echo</option><option>Foxtrot</option><option>Lima</option><option>Mike</option>
        </select>
    </div>

    <h2>Deel 1 & 2: Oefeningen</h2>
    <p>Vul de juiste vormen in. Bij het opslaan zie je wat goed (groen) of fout (rood) is.</p>
    <div id="oefen-sectie">
        <table id="oefen-tabel"></table>
    </div>

    <h2>Deel 3: Eigen Praktijkvoorbeelden</h2>
    <div id="eigen-zinnen-container">
        </div>

    <button onclick="checkAndSave()" style="width:100%; height: 50px; margin-top:20px; font-size: 1.1rem; background: #28a745;">RESULTATEN OPSLAAN</button>

    <hr style="margin:50px 0; border: 1px solid #003366;">
    
    <h2>Overzicht & Feedback</h2>
    <div id="klas-navigatie">
        <button class="nav-btn" onclick="loadResults('Delta')">Delta</button>
        <button class="nav-btn" onclick="loadResults('Echo')">Echo</button>
        <button class="nav-btn" onclick="loadResults('Foxtrot')">Foxtrot</button>
        <button class="nav-btn" onclick="loadResults('Lima')">Lima</button>
        <button class="nav-btn" onclick="loadResults('Mike')">Mike</button>
    </div>
    
    <div id="results">Selecteer een klas om de zinnen te bekijken.</div>
    
    <button class="btn-reset" onclick="hardReset()">WIS DATA KLAS</button>
    <div style="clear:both;"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCJ5of6K5MRFXMOiEqEyZxZbs1xoJtXuN8",
        authDomain: "pvaangifteinleveren.firebaseapp.com",
        databaseURL: "https://pvaangifteinleveren-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "pvaangifteinleveren",
        storageBucket: "pvaangifteinleveren.firebasestorage.app",
        messagingSenderId: "989190242332",
        appId: "1:989190242332:web:867ea95845325cf9835fd9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Initialiseer 15 velden voor deel 3
    const container = document.getElementById('eigen-zinnen-container');
    const labels = ["Stellend (als)", "Vergrotend (dan)", "Overtreffend", "Kortste vorm", "Stoffelijk", "Op -r", "Bezittelijk", "Stellend ontkennend", "Meervoud", "Onbepaald het-woord", "Kosten (dan)", "Straf (overtreffend)", "Uiterlijk (als)", "Bepaald het-woord", "Massa (dan)"];
    
    for(let i=1; i<=15; i++) {
        container.innerHTML += `<div style="margin-bottom:10px;"><b>${i}. ${labels[i-1]}:</b><input type="text" id="z${i}"></div>`;
    }

    // Exposeer functies aan window object
    window.checkAndSave = function() {
        const className = document.getElementById('selectedClass').value;
        const name = document.getElementById('firstName').value.trim();
        if(!name) return alert("Naam invullen!");

        const eigenZinnen = [];
        for(let i=1; i<=15; i++) { eigenZinnen.push(document.getElementById(`z${i}`).value); }

        push(ref(db, 'lessen/' + className), {
            student: name,
            zinnen: eigenZinnen,
            feedback: null,
            timestamp: Date.now()
        }).then(() => {
            alert("Opgeslagen! Scroll naar beneden en klik op je klas.");
        });
    };

    window.loadResults = function(c) {
        const resDiv = document.getElementById('results');
        resDiv.innerHTML = "Laden...";
        
        onValue(ref(db, 'lessen/' + c), (snapshot) => {
            resDiv.innerHTML = "";
            const data = snapshot.val();
            if(!data) { resDiv.innerHTML = "Geen inzendingen."; return; }

            Object.keys(data).forEach(key => {
                const item = data[key];
                let fbContent = "";

                if(item.feedback) {
                    fbContent = `<div class="feedback-box"><strong>Beoordeling:</strong><br>${item.feedback.replace(/\n/g, '<br>')}</div>`;
                } else {
                    fbContent = `
                    <div class="feedback-area" id="fb-area-${key}">
                        <div class="checklist-box">
                            <strong>CHECKLIST:</strong><br>
                            <input type="checkbox" id="cb1-${key}"> Stellende trap: gebruik <b>als</b> (zonder -er of -st)<br>
                            <input type="checkbox" id="cb2-${key}"> Vergrotende trap: gebruik <b>dan</b> (met -er)<br>
                            <input type="checkbox" id="cb3-${key}"> Stoffelijk: eindigt op <b>-en</b>
                        </div>
                        <textarea id="txt-${key}" placeholder="Schrijf hier je tips..."></textarea><br>
                        <button onclick="saveFeedback('${c}', '${key}')" style="margin-top:5px; background: #28a745;">Feedback versturen</button>
                    </div>`;
                }

                resDiv.innerHTML += `
                <div class="res-card">
                    <div class="card-header">Student: ${item.student}</div>
                    <div class="student-sentences">
                        ${item.zinnen.map((z, i) => `<b>${i+1}.</b> ${z}`).join('<br>')}
                    </div>
                    ${fbContent}
                </div>`;
            });
        });
    };

    window.saveFeedback = function(klas, id) {
        const c1 = document.getElementById(`cb1-${id}`).checked ? "[X] Stellende trap (als) " : "[ ] Stellende trap ";
        const c2 = document.getElementById(`cb2-${id}`).checked ? "[X] Vergrotende trap (dan) " : "[ ] Vergrotende trap ";
        const c3 = document.getElementById(`cb3-${id}`).checked ? "[X] Stoffelijk (-en) " : "[ ] Stoffelijk ";
        const txt = document.getElementById(`txt-${id}`).value;

        const fbString = `Checklist:\n${c1}\n${c2}\n${c3}\n\nToelichting: ${txt}`;
        update(ref(db, `lessen/${klas}/${id}`), { feedback: fbString });
    };

    window.hardReset = function() {
        const c = document.getElementById('selectedClass').value;
        if(confirm(`Data van klas ${c} definitief wissen?`)) {
            remove(ref(db, 'lessen/' + c));
        }
    };
</script>

</body>
</html>
